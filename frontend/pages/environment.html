<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç”Ÿæ€ç¯å¢ƒç›‘æµ‹ - å›½å®¶å…¬å›­æ™ºæ…§ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/web/assets/css/common.css" />
    <link rel="stylesheet" href="/web/assets/css/visitor.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
      /* ç¯å¢ƒç›‘æµ‹è¡¨æ ¼ç¾åŒ– */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      .data-table thead {
        background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      }
      .data-table th {
        padding: 14px 16px;
        text-align: center;
        font-weight: 600;
        color: #166534;
        font-size: 13px;
        border-bottom: 2px solid #16a34a;
      }
      .data-table td {
        padding: 12px 16px;
        text-align: center;
        border-bottom: 1px solid #f0f0f0;
        font-size: 13px;
        color: #374151;
      }
      .data-table tbody tr:hover {
        background: #f0fdf4;
      }
      .data-table tbody tr:last-child td {
        border-bottom: none;
      }
      /* çŠ¶æ€æ ‡ç­¾ */
      .tag {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }
      .tag-success { background: #dcfce7; color: #166534; }
      .tag-warning { background: #fef3c7; color: #92400e; }
      .tag-danger { background: #fee2e2; color: #991b1b; }
      .tag-info { background: #dbeafe; color: #1e40af; }
      /* è¡¨æ ¼å®¹å™¨å±…ä¸­ */
      #indicesTable, #devicesTable, #dataTable, #calibrationTable {
        max-width: 100%;
        margin: 0 auto;
      }
      /* ç­›é€‰æ æ ·å¼ */
      .filter-bar {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
        flex-wrap: wrap;
        align-items: center;
        padding: 12px 16px;
        background: #f8fafc;
        border-radius: 8px;
      }
      .filter-bar select {
        min-width: 140px;
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <aside id="sidebar" class="sidebar"></aside>
      <div class="main">
        <header id="header" class="header"></header>
        <main class="content container">
          <!-- é¡µé¢æ ‡é¢˜ -->
          <div class="page-header" style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <h1 class="page-title">ğŸŒ¡ï¸ ç”Ÿæ€ç¯å¢ƒç›‘æµ‹</h1>
              <p class="page-subtitle">ç‰©è”ç½‘è®¾å¤‡å®æ—¶é‡‡é›†ã€å¼‚å¸¸é¢„è­¦ã€è®¾å¤‡æ ¡å‡†ç®¡ç†</p>
            </div>
            <button class="btn btn-primary" onclick="EnvironmentPage.exportReport()">ğŸ“Š å¯¼å‡ºæŠ¥å‘Š</button>
          </div>

          <!-- å¼‚å¸¸é¢„è­¦æ¨ªå¹… -->
          <div id="alertBanner" style="display:none; padding: 12px 16px; background: linear-gradient(90deg, #fee2e2, #fecaca); border-left: 4px solid #dc2626; border-radius: 4px; margin-bottom: 16px;">
            <strong>ğŸš¨ å¼‚å¸¸é¢„è­¦</strong>ï¼š<span id="alertText">æ£€æµ‹åˆ°ç¯å¢ƒæ•°æ®å¼‚å¸¸</span>
          </div>

          <!-- ç»Ÿè®¡å¡ç‰‡ -->
          <div class="grid grid-4" style="margin-bottom: 24px;">
            <div class="stat-card">
              <div class="stat-icon">ğŸ“Š</div>
              <div class="stat-value" id="statIndices">--</div>
              <div class="stat-label">ç›‘æµ‹æŒ‡æ ‡</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon accent">ğŸ“¡</div>
              <div class="stat-value" id="statDevices">--</div>
              <div class="stat-label">åœ¨çº¿è®¾å¤‡</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon warning">âš ï¸</div>
              <div class="stat-value" id="statAbnormal">--</div>
              <div class="stat-label">å¼‚å¸¸æ•°æ®</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon info">ğŸ”§</div>
              <div class="stat-value" id="statCalibration">--</div>
              <div class="stat-label">å¾…æ ¡å‡†è®¾å¤‡</div>
            </div>
          </div>

          <!-- å®æ—¶ç›‘æµ‹å›¾è¡¨ -->
          <div class="card" style="margin-bottom: 24px;">
            <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;">
              <div>
                <div class="card-title">ğŸ“ˆ å®æ—¶ç¯å¢ƒç›‘æµ‹æ•°æ®</div>
                <div class="card-subtitle">ç‰©è”ç½‘è®¾å¤‡æ¯5ç§’è‡ªåŠ¨é‡‡é›†ä¸Šä¼ </div>
              </div>
              <div style="display:flex;gap:8px;align-items:center;">
                <span id="liveIndicator" style="display:flex;align-items:center;gap:4px;color:#16a34a;font-size:13px;">
                  <span style="width:8px;height:8px;background:#16a34a;border-radius:50%;animation:pulse 1s infinite;"></span> å®æ—¶é‡‡é›†ä¸­
                </span>
                <button class="btn btn-sm btn-primary" id="toggleSimulationBtn" onclick="EnvironmentPage.toggleSimulation()">â–¶ï¸ å¼€å¯æ¨¡æ‹Ÿ</button>
              </div>
            </div>
            <div class="card-body">
              <div class="grid grid-2" style="gap: 20px;">
                <div class="chart-container" style="height: 250px;">
                  <canvas id="airQualityChart"></canvas>
                </div>
                <div class="chart-container" style="height: 250px;">
                  <canvas id="waterQualityChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- é€‰é¡¹å¡ -->
          <div class="card">
            <div class="card-header">
              <div class="tabs" id="tabs">
                <button class="tab active" data-tab="indices">ç›‘æµ‹æŒ‡æ ‡</button>
                <button class="tab" data-tab="devices">ç›‘æµ‹è®¾å¤‡</button>
                <button class="tab" data-tab="data">ç¯å¢ƒæ•°æ®</button>
                <button class="tab" data-tab="calibration">æ ¡å‡†è®°å½•</button>
                <button class="tab" data-tab="alerts">ğŸš¨ é¢„è­¦ä¿¡æ¯</button>
              </div>
              <button class="btn btn-primary" id="createBtn">â• æ–°å¢</button>
            </div>
            <div class="card-body">
              <!-- ç›‘æµ‹æŒ‡æ ‡ -->
              <div class="tab-content active" id="tab-indices">
                <div class="notice notice-info" style="margin-bottom:16px;">
                  ğŸ“‹ ç›‘æµ‹æŒ‡æ ‡å®šä¹‰ç¯å¢ƒå‚æ•°çš„æ ‡å‡†é˜ˆå€¼ï¼Œè¶…å‡ºé˜ˆå€¼çš„æ•°æ®å°†è‡ªåŠ¨æ ‡è®°ä¸ºå¼‚å¸¸
                </div>
                <div id="indicesTable"></div>
              </div>
              
              <!-- ç›‘æµ‹è®¾å¤‡ -->
              <div class="tab-content" id="tab-devices">
                <div class="notice notice-info" style="margin-bottom:16px;">
                  ğŸ“¡ ç›‘æµ‹è®¾å¤‡çŠ¶æ€æ¯å°æ—¶è‡ªåŠ¨æ›´æ–°ï¼Œæ•…éšœè®¾å¤‡ä¼šè§¦å‘æé†’ã€‚æ ¡å‡†å‘¨æœŸåˆ°æœŸéœ€åŠæ—¶æ ¡å‡†
                </div>
                <div id="devicesTable"></div>
              </div>
              
              <!-- ç¯å¢ƒæ•°æ® -->
              <div class="tab-content" id="tab-data">
                <div class="filter-bar">
                  <span style="font-weight:500;color:#374151;">ğŸ” ç­›é€‰æ¡ä»¶ï¼š</span>
                  <select class="field-select" id="dataFilterIndex">
                    <option value="">å…¨éƒ¨æŒ‡æ ‡</option>
                  </select>
                  <select class="field-select" id="dataFilterArea">
                    <option value="">å…¨éƒ¨åŒºåŸŸ</option>
                    <option value="1">æ ¸å¿ƒä¿æŠ¤åŒº</option>
                    <option value="2">ç¼“å†²åŒº</option>
                    <option value="3">å®éªŒåŒº</option>
                  </select>
                  <select class="field-select" id="dataFilterAbnormal">
                    <option value="">å…¨éƒ¨æ•°æ®</option>
                    <option value="1">ä»…å¼‚å¸¸æ•°æ®</option>
                    <option value="0">ä»…æ­£å¸¸æ•°æ®</option>
                  </select>
                  <button class="btn btn-primary" onclick="EnvironmentPage.filterData()">åº”ç”¨ç­›é€‰</button>
                  <button class="btn btn-secondary" onclick="EnvironmentPage.resetFilter()">é‡ç½®</button>
                </div>
                <div id="dataTable"></div>
              </div>
              
              <!-- æ ¡å‡†è®°å½• -->
              <div class="tab-content" id="tab-calibration">
                <div class="notice notice-info" style="margin-bottom:16px;">
                  ğŸ”§ æŠ€æœ¯äººå‘˜å®šæœŸæ ¡å‡†ç›‘æµ‹è®¾å¤‡ï¼Œç¡®ä¿æ•°æ®å‡†ç¡®æ€§ã€‚æ ¡å‡†åè‡ªåŠ¨æ›´æ–°è®¾å¤‡çŠ¶æ€
                </div>
                <div id="calibrationTable"></div>
              </div>
              
              <!-- é¢„è­¦ä¿¡æ¯ -->
              <div class="tab-content" id="tab-alerts">
                <div class="notice notice-warning" style="margin-bottom:16px;">
                  ğŸš¨ ç³»ç»Ÿè‡ªåŠ¨å¯¹æ¯”ç›‘æµ‹å€¼ä¸æ ‡å‡†é˜ˆå€¼ï¼Œç”Ÿæˆå¼‚å¸¸æ•°æ®é¢„è­¦ã€‚åŒ…å«è®¾å¤‡æ•…éšœé¢„è­¦å’Œç¯å¢ƒæ•°æ®è¶…æ ‡é¢„è­¦
                </div>
                <div id="alertsTable"></div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="/web/assets/js/api.js"></script>
    <script src="/web/assets/js/auth.js"></script>
    <script src="/web/assets/js/common.js"></script>
    <script src="/web/assets/js/environment.js"></script>
    <script>
      (function () {
        if (!Auth.requireLogin()) return;
        Common.initLayout({ active: "environment", pageTitle: "ç¯å¢ƒç›‘æµ‹" }).then(function (ctx) {
          EnvironmentPage.init(ctx.profile);
        });
      })();
    </script>
  </body>
</html>

