<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ‰§æ³•ç›‘ç®¡ - å›½å®¶å…¬å›­æ™ºæ…§ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/web/assets/css/common.css" />
    <link rel="stylesheet" href="/web/assets/css/visitor.css" />
    <style>
      /* ç¾åŒ–è¡¨æ ¼æ ·å¼ */
      .enforcement-table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
      .enforcement-table thead { background: linear-gradient(135deg, #f59e0b, #d97706); }
      .enforcement-table th { padding: 14px 12px; text-align: center; font-weight: 600; color: #fff; font-size: 13px; letter-spacing: 0.5px; }
      .enforcement-table td { padding: 12px; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 13px; }
      .enforcement-table tbody tr { transition: all 0.2s ease; }
      .enforcement-table tbody tr:hover { background: linear-gradient(90deg, #fffbeb, #fef3c7); transform: scale(1.005); }
      .enforcement-table tbody tr:nth-child(even) { background: #fefce8; }
      .enforcement-table tbody tr:nth-child(even):hover { background: linear-gradient(90deg, #fffbeb, #fef3c7); }
      .enforcement-table tbody tr.row-danger { background: linear-gradient(90deg, #fef2f2, #fee2e2) !important; }
      .enforcement-table tbody tr.row-danger:hover { background: linear-gradient(90deg, #fee2e2, #fecaca) !important; }
      
      /* æ ‡ç­¾æ ·å¼ */
      .tag { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
      .tag-success { background: linear-gradient(135deg, #dcfce7, #bbf7d0); color: #166534; }
      .tag-warning { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; }
      .tag-danger { background: linear-gradient(135deg, #fee2e2, #fecaca); color: #991b1b; }
      .tag-info { background: linear-gradient(135deg, #dbeafe, #bfdbfe); color: #1e40af; }
      .tag-purple { background: linear-gradient(135deg, #f3e8ff, #e9d5ff); color: #7c3aed; }
      
      /* ç­›é€‰æ  */
      .filter-bar { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; align-items: center; padding: 14px 18px; background: linear-gradient(90deg, #f8fafc, #f1f5f9); border-radius: 12px; border: 1px solid #e2e8f0; }
      
      /* é¢„è­¦æ¨ªå¹… */
      .alert-banner { padding: 14px 18px; background: linear-gradient(90deg, #fef3c7, #fde68a); border-left: 4px solid #f59e0b; border-radius: 8px; margin-bottom: 16px; display: none; box-shadow: 0 2px 8px rgba(245,158,11,0.2); }
      .alert-banner.danger { background: linear-gradient(90deg, #fee2e2, #fecaca); border-left-color: #dc2626; animation: pulse-danger 2s infinite; }
      
      @keyframes pulse-danger {
        0%, 100% { box-shadow: 0 2px 8px rgba(220,38,38,0.3); }
        50% { box-shadow: 0 4px 16px rgba(220,38,38,0.5); }
      }
      
      /* æŒ‰é’®åŠ¨ç”» */
      .btn { transition: all 0.2s ease; }
      .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
      
      /* å›¾ç‰‡ä¸Šä¼ é¢„è§ˆ */
      .image-preview { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
      .image-preview img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb; }
      .image-upload-area { border: 2px dashed #d1d5db; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; }
      .image-upload-area:hover { border-color: #f59e0b; background: #fffbeb; }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <aside id="sidebar" class="sidebar"></aside>
      <div class="main">
        <header id="header" class="header"></header>
        <main class="content container">
          <div class="page-header" style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <h1 class="page-title">ğŸ›¡ï¸ æ‰§æ³•ç›‘ç®¡</h1>
              <p class="page-subtitle">æ™ºèƒ½è§†é¢‘ç›‘æ§ã€éæ³•è¡Œä¸ºè¯†åˆ«ã€æ‰§æ³•äººå‘˜è°ƒåº¦ã€å…¨æµç¨‹è·Ÿè¸ª</p>
            </div>
            <button class="btn btn-danger" onclick="EnforcementPage.simulateAlert()">ğŸš¨ æ¨¡æ‹Ÿé¢„è­¦</button>
          </div>

          <!-- é¢„è­¦æ¨ªå¹… -->
          <div id="alertBanner" class="alert-banner danger">
            <strong>ğŸš¨ æ™ºèƒ½é¢„è­¦</strong>ï¼š<span id="alertText">æ£€æµ‹åˆ°éæ³•è¡Œä¸º</span>
            <button class="btn btn-sm btn-danger" onclick="EnforcementPage.handleAlert()" style="margin-left:12px;">ç«‹å³è°ƒåº¦</button>
          </div>

          <!-- ç»Ÿè®¡å¡ç‰‡ -->
          <div class="grid grid-4" style="margin-bottom: 24px;">
            <div class="stat-card">
              <div class="stat-icon">ğŸ‘®</div>
              <div class="stat-value" id="statStaff">--</div>
              <div class="stat-label">æ‰§æ³•äººå‘˜</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon accent">ğŸ“¹</div>
              <div class="stat-value" id="statMonitors">--</div>
              <div class="stat-label">è§†é¢‘ç›‘æ§ç‚¹</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon warning">âš ï¸</div>
              <div class="stat-value" id="statRecords">--</div>
              <div class="stat-label">éæ³•è¡Œä¸ºè®°å½•</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon info">ğŸš—</div>
              <div class="stat-value" id="statDispatch">--</div>
              <div class="stat-label">å¾…å¤„ç†è°ƒåº¦</div>
            </div>
          </div>

          <!-- é€‰é¡¹å¡ -->
          <div class="card">
            <div class="card-header">
              <div class="tabs" id="tabs">
                <button class="tab active" data-tab="staff">æ‰§æ³•äººå‘˜</button>
                <button class="tab" data-tab="monitors">è§†é¢‘ç›‘æ§ç‚¹</button>
                <button class="tab" data-tab="records">éæ³•è¡Œä¸ºè®°å½•</button>
                <button class="tab" data-tab="dispatch">æ‰§æ³•è°ƒåº¦</button>
                <button class="tab" data-tab="alerts">ğŸš¨ é¢„è­¦ä¸­å¿ƒ</button>
              </div>
              <button class="btn btn-primary" id="createBtn">â• æ–°å¢</button>
            </div>
            <div class="card-body">
              <div id="notice" class="notice notice-warning" style="display: none"></div>
              
              <!-- æ‰§æ³•äººå‘˜ -->
              <div class="tab-content active" id="tab-staff">
                <div class="notice notice-info" style="margin-bottom:16px;">
                  ğŸ‘® æ‰§æ³•äººå‘˜ä¿¡æ¯ç®¡ç†ï¼ŒåŒ…å«IDã€å§“åã€éƒ¨é—¨ã€æƒé™ã€è”ç³»æ–¹å¼ã€è®¾å¤‡ç¼–å·
                </div>
                <div id="staffTable"></div>
              </div>
              
              <!-- è§†é¢‘ç›‘æ§ç‚¹ -->
              <div class="tab-content" id="tab-monitors">
                <div class="notice notice-info" style="margin-bottom:16px;">
                  ğŸ“¹ è§†é¢‘ç›‘æ§ç‚¹ç®¡ç†ï¼Œç›‘æ§ç‚¹ç¼–å·å”¯ä¸€ï¼Œæ•°æ®å­˜å‚¨å‘¨æœŸé»˜è®¤90å¤©ï¼Œæ ¸å¿ƒåŒºåŸŸå¯å»¶é•¿è‡³180å¤©
                </div>
                <div id="monitorsTable"></div>
              </div>
              
              <!-- éæ³•è¡Œä¸ºè®°å½• -->
              <div class="tab-content" id="tab-records">
                <div class="filter-bar">
                  <span style="font-weight:500;">ğŸ” ç­›é€‰ï¼š</span>
                  <select class="field-select" id="filterStatus" style="width:120px;">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="æœªå¤„ç†">æœªå¤„ç†</option>
                    <option value="å¤„ç†ä¸­">å¤„ç†ä¸­</option>
                    <option value="å·²ç»“æ¡ˆ">å·²ç»“æ¡ˆ</option>
                  </select>
                  <select class="field-select" id="filterType" style="width:120px;">
                    <option value="">å…¨éƒ¨ç±»å‹</option>
                    <option value="éæ³•è¿›å…¥">éæ³•è¿›å…¥</option>
                    <option value="ç›—çŒ">ç›—çŒ</option>
                    <option value="ç ´åæ¤è¢«">ç ´åæ¤è¢«</option>
                    <option value="éæ³•é‡‡é›†">éæ³•é‡‡é›†</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                  </select>
                  <button class="btn btn-primary" onclick="EnforcementPage.filterRecords()">ç­›é€‰</button>
                  <button class="btn btn-secondary" onclick="EnforcementPage.resetFilter()">é‡ç½®</button>
                </div>
                <div id="recordsTable"></div>
              </div>
              
              <!-- æ‰§æ³•è°ƒåº¦ -->
              <div class="tab-content" id="tab-dispatch">
                <div class="notice notice-info" style="margin-bottom:16px;">
                  ğŸš— æ‰§æ³•è°ƒåº¦ä¿¡æ¯ï¼Œä¸éæ³•è¡Œä¸ºè®°å½•ã€æ‰§æ³•äººå‘˜å¼ºå…³è”ï¼Œè·Ÿè¸ªå¤„ç½®å…¨æµç¨‹
                </div>
                <div id="dispatchTable"></div>
              </div>
              
              <!-- é¢„è­¦ä¸­å¿ƒ -->
              <div class="tab-content" id="tab-alerts">
                <div class="notice notice-warning" style="margin-bottom:16px;">
                  ğŸš¨ æ™ºèƒ½è§†é¢‘ç›‘æ§è‡ªåŠ¨è¯†åˆ«éæ³•è¡Œä¸ºï¼Œç”Ÿæˆé¢„è­¦å¹¶è§¦å‘å°±è¿‘æ‰§æ³•äººå‘˜è°ƒåº¦
                </div>
                <div id="alertsTable"></div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="/web/assets/js/api.js"></script>
    <script src="/web/assets/js/auth.js"></script>
    <script src="/web/assets/js/common.js"></script>
    <script src="/web/assets/js/enforcement.js"></script>
    <script>
      (function () {
        if (!Auth.requireLogin()) return;
        Common.initLayout({ active: "enforcement", pageTitle: "æ‰§æ³•ç›‘ç®¡" }).then(function (ctx) {
          EnforcementPage.init(ctx.profile);
        });
      })();
    </script>
  </body>
</html>

